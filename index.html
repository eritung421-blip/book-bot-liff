<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI æ™ºèƒ½æ›¸ç±ç´€éŒ„</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            --primary: #455A64;   /* æ·±å²©ç° */
            --secondary: #78909C; /* è—ç° */
            --accent: #81C784;    /* è«è˜­è¿ªç¶  */
            --bg: #F5F7F8;
            --white: #FFFFFF;
            --text: #37474F;
            --error: #E57373;
        }

        body {
            font-family: -apple-system, "Noto Sans TC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }

        .container {
            width: 100%; max-width: 450px;
            background: var(--white);
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--primary);
            font-size: 1.4rem;
            text-align: center;
            margin-top: 0; margin-bottom: 25px;
            letter-spacing: 2px;
        }

        .form-group { margin-bottom: 18px; }

        label {
            display: block; font-size: 0.9rem; font-weight: 600;
            margin-bottom: 8px; color: var(--secondary);
        }

        input, select, textarea {
            width: 100%; padding: 12px;
            border: 1px solid #ECEFF1; border-radius: 10px;
            font-size: 1rem; box-sizing: border-box;
            background-color: #FAFAFA; color: var(--text);
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--secondary);
            background-color: #FFF; box-shadow: 0 0 0 3px rgba(120, 144, 156, 0.1);
        }

        button {
            width: 100%; padding: 15px;
            background-color: var(--primary);
            color: white; border: none; border-radius: 12px;
            font-size: 1.1rem; font-weight: 600;
            cursor: pointer; transition: 0.3s;
            margin-top: 15px;
        }

        button:disabled { background-color: #B0BEC5; cursor: not-allowed; }

        /* æˆåŠŸé®ç½© */
        #success-overlay {
            display: none; position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--white); z-index: 100;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }

        .check-icon {
            width: 90px; height: 90px; background: var(--accent);
            color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 50px; margin-bottom: 25px;
            animation: pop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        .btn-group { display: flex; gap: 12px; width: 85%; margin-top: 20px; }
        .btn-outline { background: transparent; border: 1.5px solid var(--secondary); color: var(--secondary); }

        #loading-text {
            display: none; text-align: center; color: var(--secondary);
            font-size: 0.9rem; margin-top: 15px; font-style: italic;
        }
    </style>
</head>
<body>

<div class="container" id="form-container">
    <h2>ğŸ“– æ™ºèƒ½é–±è®€ç´€éŒ„</h2>
    <form id="bookForm">
        <div class="form-group">
            <label>æ›¸å (å¿…å¡«)</label>
            <input type="text" id="title" required placeholder="ä¾‹å¦‚ï¼šåŸå­ç¿’æ…£">
        </div>
        <div class="form-group">
            <label>ä½œè€…</label>
            <input type="text" id="author" placeholder="è©¹å§†æ–¯ï¼å…‹åˆ©çˆ¾">
        </div>
        <div class="form-group">
            <label>é¡åˆ¥</label>
            <select id="category">
                <option value="è‡ªæˆ‘æˆé•·">è‡ªæˆ‘æˆé•·</option>
                <option value="å¿ƒç†å­¸">å¿ƒç†å­¸</option>
                <option value="å•†æ¥­ç†è²¡">å•†æ¥­ç†è²¡</option>
                <option value="æ–‡å­¸å°èªª">æ–‡å­¸å°èªª</option>
                <option value="ç§‘æŠ€è¶¨å‹¢">ç§‘æŠ€è¶¨å‹¢</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
        </div>
        <div class="form-group">
            <label>ç›®å‰ç‹€æ…‹</label>
            <select id="status">
                <option value="é¡˜æœ›æ¸…å–®ğŸ§š">é¡˜æœ›æ¸…å–®ğŸ§š</option>
                <option value="å·²è³¼å…¥ğŸ›’">å·²è³¼å…¥ğŸ›’</option>
                <option value="æ­£åœ¨è®€ğŸ“–">æ­£åœ¨è®€ğŸ“–</option>
                <option value="é–±è®€å®Œç•¢â˜‘ï¸" selected>é–±è®€å®Œç•¢â˜‘ï¸</option>
            </select>
        </div>
        <div class="form-group">
            <label>æ¨è–¦æŒ‡æ•¸</label>
            <select id="rating">
                <option value="â­â­â­â­â­">â­â­â­â­â­ (æ¥µæ¨)</option>
                <option value="â­â­â­â­">â­â­â­â­ (å€¼å¾—è®€)</option>
                <option value="â­â­â­">â­â­â­ (æ™®é€š)</option>
                <option value="â­â­">â­â­ (ä¸æ¨)</option>
                <option value="â­">â­ (é›·)</option>
            </select>
        </div>
        <div class="form-group">
            <label>è®€å¾Œæ„Ÿ / ç­†è¨˜</label>
            <textarea id="review" rows="4" placeholder="è¼¸å…¥ä½ çš„å¿ƒå¾—ï¼ŒAI æœƒå¹«ä½ ç”Ÿæˆé‡‘å¥..."></textarea>
        </div>
        <button type="submit" id="submitBtn">ç¢ºèªå„²å­˜è‡³ Notion</button>
        <div id="loading-text">âœ¨ AI æ­£åœ¨åˆ†æå…§å®¹ä¸¦åŒæ­¥è³‡æ–™åº«...</div>
    </form>
</div>

<div id="success-overlay">
    <div class="check-icon">âœ“</div>
    <h3 style="color: var(--primary); margin: 0;">ç´€éŒ„æˆåŠŸ</h3>
    <p style="color: var(--secondary); margin: 10px 0 30px 0;">å·²å®Œæˆ AI æ‘˜è¦èˆ‡é‡‘å¥ç”Ÿæˆ</p>
    <div class="btn-group">
        <button onclick="location.reload()">å†è¨˜ä¸€æœ¬</button>
        <button class="btn-outline" onclick="liff.closeWindow()">é—œé–‰é é¢</button>
    </div>
</div>

<script>
    // ğŸ”´ è«‹å‹™å¿…å¡«å…¥ä½ çš„ GAS Web App URL
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwfb7Y__PXhvAi16EOTM1W5u2ayYe7XwN5P4aiyHMctNOQlTcjDCWi6h-lkhU2mqUjz_A/exec"; 
    const MY_LIFF_ID = "2008731100-q3JK2BPf";

    async function init() {
        try {
            await liff.init({ liffId: MY_LIFF_ID });
            if (!liff.isLoggedIn()) liff.login();
        } catch (err) { console.error('LIFF Init Failed', err); }
    }

    document.getElementById('bookForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const load = document.getElementById('loading-text');
        
        btn.disabled = true;
        load.style.display = 'block';

        const payload = {
            action: 'liff_submit',
            data: {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value || 'æœªçŸ¥',
                category: document.getElementById('category').value,
                status: document.getElementById('status').value,
                rating: document.getElementById('rating').value,
                review: document.getElementById('review').value,
                dateStr: new Date().toISOString().slice(0, 7)
            }
        };

        try {
            // ä½¿ç”¨ no-cors æ¨¡å¼ç™¼é€ï¼Œé›–ç„¶ç„¡æ³•è®€å– responseï¼Œä½†èƒ½ç¢ºä¿è«‹æ±‚é€é” GAS
            await fetch(GAS_WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            // å»¶é²ä¸€ç§’é¡¯ç¤ºæˆåŠŸï¼Œå¢åŠ å¿ƒç†æ„Ÿå—
            setTimeout(() => {
                document.getElementById('success-overlay').style.display = 'flex';
            }, 1500);
            
        } catch (error) {
            alert('ç³»çµ±å¿™ç¢Œä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ï¼');
            btn.disabled = false;
            load.style.display = 'none';
        }
    });

    init();
</script>

</body>
</html>
